/*!
 * Copyright (c) 2018 Yuri Sulyma
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 * 
 */
var RactiveEditor=function(e){var t={};function n(r){if(t[r])return t[r].exports;var a=t[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,n),a.l=!0,a.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(r,a,function(t){return e[t]}.bind(null,a));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=2)}([function(e,t){e.exports=React},function(e,t){e.exports=RactivePlayer},function(e,t,n){"use strict";n.r(t);var r={};n.r(r),n.d(r,"$",function(){return s}),n.d(r,"$$",function(){return i}),n.d(r,"elt",function(){return o}),n.d(r,"fragmentFromHTML",function(){return c}),n.d(r,"remove",function(){return l});var a=n(0);function s(e,t=document){return t.querySelector(e)}function i(e,t=document){return Array.from(t.querySelectorAll(e))}function o(e){return document.createElement(e)}function c(e){const t=document.createElement("template");return t.innerHTML=e,t.content.cloneNode(!0)}function l(e){e.parentNode.removeChild(e)}function d(){for(const e of["webkitIsFullScreen","mozFullScreen"])if(void 0!==document[e])return document[e]}var u=n(1);const{$:h,$$:m}=r,{bind:p,waitFor:g}=u.Utils.misc,f=u.Utils.misc.wait,y={cols:5,rows:5,height:100,width:160,frequency:4};class v extends u.Player.PureReceiver{constructor(e){super(e),this.player=e.player,p(this,["recordThumbs","togglePane"]),this.state={paneOpen:!1,sheets:[]}}componentDidMount(){window.hasOwnProperty("RACTIVE_GLOBAL")||(window.RACTIVE_GLOBAL={}),RACTIVE_GLOBAL.Controls=RACTIVE_GLOBAL.Controls||{},RACTIVE_GLOBAL.Controls.ThumbRecorder=this}async recordThumbs(){const e=d(),t=await function(e){let t=0;const n={};return new Promise((r,a)=>{e.onMessage.addListener(a=>{switch(a.type){case"apiDefinition":const s={};a.methodNames.forEach(r=>{s[r]=((...a)=>{const s=t++;return e.postMessage({type:"apiCall",callId:s,methodName:r,arguments:a}),new Promise((e,t)=>{n[s]=e})})}),Object.freeze(s),r(s);break;case"apiReturn":const{callId:i}=a;n[i](a.value),delete n[i]}}),e.postMessage({type:"establish"})})}(chrome.runtime.connect("mokgmmlldhhiafndljjdiaegiffnfogo")),{cols:n,rows:r,height:a,width:s,frequency:i}=y,c=[];!function(){for(const e of["webkitRequestFullscreen","mozRequestFullScreen","msRequestFullscreen"])if(document.body[e])return document.body[e]()}(),await g(()=>d());const l=function(){const e=[[h(".rp-controls"),"display","none"],[h(".rp-canvas"),"cursor","none"],[document.body,"cursor","none"]];for(let t=0;t<e.length;++t){const[n,r,a]=e[t];e[t][2]=n.style[r],n.style[r]=a}return e}();await f(6e3);const{playback:u}=this.player;for(let e=0,n=u.length;e<=n;e+=1e3*i)u.seek(e),await f(100),c.push(await t.captureTab());e||function(){for(const e of["webkitExitFullscreen","mozCancelFullScreen","msExitFullscreen"])if(document[e])return document[e]()}(),function(e){for(let[t,n,r]of e)t.style[n]=r}(l);const m=await async function(e){const{rows:t,cols:n,height:r,width:a}=y,s=t*n,i=o("canvas");i.setAttribute("width",(a*n).toString()),i.setAttribute("height",(r*t).toString());const c=i.getContext("2d"),l=[];for(let d=0,u=Math.ceil(e.length/s);d<u;++d){c.clearRect(0,0,a*n,r*t);const u=await Promise.all(e.slice(d*s,(d+1)*s).map(e=>new Promise((t,n)=>{const r=o("img");r.onload=(()=>t(r)),r.src=e})));for(let e=0;e<t;++e)for(let t=0;t<n;++t){const s=e*n+t;if(s>=u.length)break;c.drawImage(u[s],t*a,e*r,a,r)}l.push(i.toDataURL("image/png"))}return l}(c);this.setState({sheets:m})}togglePane(){this.setState({paneOpen:!this.state.paneOpen})}render(){const{paneOpen:e}=this.state,t={display:e?"block":"none"};return a.createElement("div",{id:"editor-thumb-recorder"},a.createElement("div",{id:"saved-thumbs-dialog",style:t},a.createElement("button",{onClick:this.recordThumbs},"Record"),a.createElement("div",{id:"sheets"},this.state.sheets.map((e,t)=>a.createElement("a",{key:t,href:e,download:`${t}.png`},"Sheet ",t)))),a.createElement("svg",{onClick:this.togglePane,height:"36",width:"36",viewBox:"0 0 100 100"},a.createElement("path",{d:"M 10 70 a 1,1 0 0,1 80,0 z",fill:"#FFC0CB",stroke:"#FFF",strokeWidth:"7"}),a.createElement("path",{d:"M 35 66.5 a 1,1 0 0,1 30,0 z",fill:"#FFE0EB",stroke:"none"})))}}const{bind:E}=u.Utils.misc,w=["left","top","position","height","width"];class b extends a.PureComponent{constructor(e){super(e),E(this,["copyData","togglePane"]),this.state={data:{},paneOpen:!1}}async copyData(){const e=window[Symbol.for("XXX hack IdMap")];if(!e)return void console.log("This feature is still a hacky mess. Must set window[@XXX hack IdMap]");const t={};for(const n of Object.keys(e).sort()){const r=s(`#${n}`);t[n]=r?R(r):e[n]}const n=document.location.pathname.split("/")[2],r=await fetch(`/d/editor/${n}/save_object`,{body:JSON.stringify(t),headers:[["Content-Type","application/json"],["X-Requested-With","XMLHttpRequest"],["X-CSRF-Token",window.csrfToken]],method:"POST"}),a=await r.text();console.log(a)}togglePane(){this.setState({paneOpen:!this.state.paneOpen})}render(){const{paneOpen:e}=this.state,t={display:e?"block":"none"};return a.createElement("div",{id:"editor-objects-thing"},a.createElement("div",{id:"editor-objects-dialog",style:t},a.createElement("textarea",{readOnly:!0,value:JSON.stringify(this.state.data,null,2)}),a.createElement("button",{onClick:this.copyData},"Update data")),a.createElement("svg",{onClick:this.togglePane,height:"36",width:"36",viewBox:"0 0 100 100"},a.createElement("text",{dominantBaseline:"middle",fill:"#FFF",fontFamily:"Verdana",textAnchor:"middle",x:50,y:50,fontSize:50},"{}")))}}function R(e){const t={},n=["transform"];for(const r of Array.from(e.attributes))r.specified&&n.includes(r.nodeName)&&(t[r.nodeName]=r.textContent);if(e.style){t.style={};for(let n=0;n<e.style.length;++n){const r=e.style.item(n);w.includes(r)&&(t.style[k(r)]=e.style[r])}}return t}function k(e){return e.split("-").map((e,t)=>0===t?e:e[0].toUpperCase()+e.slice(1)).join("")}function x(e,t,n){return e.removeEventListener(t,n)}function C(e,...t){let[n,r,a]=t;e instanceof Array?e.map(e=>C(e,...t)):(2===t.length&&(a=r,r=null),r?e.addEventListener(n,t=>{let n=t.target;for(;n!=e;){if(n.matches(r))return a.call(n,t,n);n=n.parentNode}},!0):e.addEventListener(n,a))}const{bind:S}=u.Utils.misc;class F extends a.PureComponent{constructor(e){super(e),S(this,["toggleActive"]),this.state={active:!1}}toggleActive(){this.props.setPluginActive(!this.state.active),this.setState({active:!this.state.active})}}class T extends u.Player.PureReceiver{constructor(e){super(e),this.plugins=e.plugins,this.player=e.player,this.isPluginActive={},this.pluginMap={};for(const e of this.plugins)this.pluginMap[e.name]=e,this.isPluginActive[e.name]=!1;this.activeRecorders=new Map,S(this,["togglePane","onKeyDown","beginRecording","endRecording"]),this.state={isPaneOpen:!1,isRecording:!1,recordings:[],paused:!1}}componentDidMount(){C(document.body,"keydown",this.onKeyDown),C(window,"beforeunload",e=>{this.state.recordings.length>0&&(e.returnValue="You have recording data")})}onKeyDown(e){this.player.$controls.captureKeys&&("Digit2"===e.code&&e.altKey&&e.metaKey&&(this.state.isRecording?this.endRecording(!0):this.beginRecording()),"Digit3"===e.code&&e.altKey&&e.metaKey&&this.state.isRecording?this.state.paused?this.resumeRecording():this.pauseRecording():"Digit4"===e.code&&e.altKey&&e.metaKey&&this.state.isRecording&&this.endRecording(!1))}beginRecording(){const e=performance.now();this.activeRecorders.clear();for(const t of this.plugins){if(!this.isPluginActive[t.name])continue;const n=new t.recorder(this.player);n.beginRecording(e),this.activeRecorders.set(t,n)}0===this.activeRecorders.size&&alert("No recorders active!"),this.setState({isRecording:!0})}pauseRecording(){const e=performance.now();for(const t of this.plugins)this.isPluginActive[t.name]&&this.activeRecorders.get(t).pauseRecording(e);this.setState({paused:!0})}resumeRecording(){const e=performance.now();for(const t of this.plugins)this.isPluginActive[t.name]&&this.activeRecorders.get(t).resumeRecording(e);this.setState({paused:!1})}endRecording(e){const t=performance.now(),n={};for(const r of this.plugins){if(!this.isPluginActive[r.name])continue;const a=this.activeRecorders.get(r).endRecording(t);e&&(n[r.name]=void 0,a.then(e=>{console.log("done recording "+r.name),n[r.name]=e,this.forceUpdate()}))}this.setState({isRecording:!1,recordings:e?this.state.recordings.concat([n]):this.state.recordings})}togglePane(){this.setState({isPaneOpen:!this.state.isPaneOpen})}render(){const e={display:this.state.isPaneOpen?"block":"none"};return a.createElement("div",{id:"editor-recorder"},a.createElement("div",{id:"editor-recorder-dialog",style:e},a.createElement("table",{id:"editor-recorder-commands"},a.createElement("tbody",null,a.createElement("tr",null,a.createElement("th",null,a.createElement("kbd",null,"Alt+Cmd+2")),a.createElement("td",null,"Start/Stop recording")),a.createElement("tr",null,a.createElement("th",null,a.createElement("kbd",null,"Alt+Cmd+3")),a.createElement("td",null,"Pause/Resume recording")),a.createElement("tr",null,a.createElement("th",null,a.createElement("kbd",null,"Alt+Cmd+4")),a.createElement("td",null,"Discard recording")))),a.createElement(u.Player.Broadcaster,null,a.createElement("h3",null,"Configuration"),this.plugins.map((e,t)=>{const n=e.configureComponent;return a.createElement(n,Object.assign({key:t},{setPluginActive:t=>this.isPluginActive[e.name]=t}))}),a.createElement("h3",null,"Saved data"),a.createElement("ol",{className:"recordings"},this.state.recordings.map((e,t)=>a.createElement(P,{key:t,data:e,pluginMap:this.pluginMap}))))),a.createElement("svg",{onClick:this.togglePane,height:"36",width:"36",viewBox:"-50 -50 100 100"},a.createElement("circle",{cx:"0",cy:"0",r:"35",stroke:"white",strokeWidth:"5",fill:this.state.isRecording?this.state.paused?"blue":"red":"#666"})))}}class P extends u.Player.Receiver{constructor(e){super(e),this.player=e.player,console.log(this.props),this.state={name:"Untitled"}}render(){const{data:e,pluginMap:t}=this.props,n={onFocus:()=>this.player.$controls.captureKeys=!1,onBlur:()=>this.player.$controls.captureKeys=!0};return a.createElement("li",{className:"recording-row"},a.createElement("input",Object.assign({},n,{className:"recording-name",onChange:e=>this.setState({name:e.target.value}),type:"text",value:this.state.name})),a.createElement("table",{className:"recording-results"},a.createElement("tbody",null,Object.keys(e).map(n=>{const r=t[n].saveComponent;return a.createElement("tr",{key:n},a.createElement(r,{data:e[n]}))}))))}}const N=a.createElement("svg",{x:"0",y:"10",height:"80",viewBox:"0 0 462.86 792.01"},a.createElement("g",{stroke:"#FFF",transform:"translate(-140.62 -173.21)"},a.createElement("path",{opacity:".99",d:"m568.57 620.93c0 116.77-94.66 211.43-211.43 211.43s-211.43-94.66-211.43-211.43v-0.00001",fillOpacity:"0",transform:"translate(14.904)",strokeLinecap:"round",strokeWidth:"20"}),a.createElement("path",{opacity:".99",d:"m568.57 620.93c0 116.77-94.66 211.43-211.43 211.43s-211.43-94.66-211.43-211.43v-0.00001",fillOpacity:"0",transform:"translate(14.904)",strokeLinecap:"round",strokeWidth:"40"}),a.createElement("path",{d:"m372.05 832.36v114.29",strokeWidth:"30",fill:"none"}),a.createElement("path",{fill:"#FFF",opacity:".99",d:"m197.14 920.93c0.00001-18.935 59.482-34.286 132.86-34.286 73.375 0 132.86 15.35 132.86 34.286z",transform:"translate(42.047 34.286)",strokeLinecap:"round",strokeWidth:"20"}),a.createElement("path",{fill:"#FFF",opacity:".99",strokeWidth:"21.455",strokeLinecap:"round",d:"m372.06 183.94c-77.019-0.00001-139.47 62.45-139.47 139.47v289.62c0 77.019 62.45 139.47 139.47 139.47 77.019 0 139.44-62.45 139.44-139.47v-289.62c0-77.02-62.42-139.47-139.44-139.47z"})));const D={name:"AudioRecorder",recorder:class{beginRecording(e){"https:"!==document.location.protocol&&alert("Page must be accessed via HTTPS in order to record audio"),this.promise=new Promise(async(e,t)=>{const n=await navigator.mediaDevices.getUserMedia({audio:!0}),r=[];this.recorder=new MediaRecorder(n),C(this.recorder,"dataavailable",e=>{r.push(e.data)}),C(this.recorder,"stop",()=>{const t=new Blob(r,{type:"audio/webm"});e(URL.createObjectURL(t))}),this.recorder.start(1e3)})}pauseRecording(){this.recorder.pause()}resumeRecording(){this.recorder.resume()}async endRecording(){return this.recorder.stop(),this.promise}},configureComponent:class extends F{render(){const e=["recorder-plugin-icon"];return this.state.active&&e.push("active"),a.createElement("div",{className:"recorder-plugin",title:"Record audio"},a.createElement("svg",{className:e.join(" "),height:"36",width:"36",viewBox:"0 0 100 100",onClick:this.toggleActive},a.createElement("rect",{height:"100",width:"100",fill:this.state.active?"red":"#222"}),N),a.createElement("span",{className:"recorder-plugin-name"},"Audio"))}},saveComponent:function(e){return a.createElement(a.Fragment,null,a.createElement("th",{key:"head",scope:"row"},a.createElement("svg",{className:"recorder-plugin-icon",height:"36",width:"36",viewBox:"0 0 100 100"},a.createElement("rect",{height:"100",width:"100",fill:"#222"}),N)),a.createElement("td",{key:"cell"},e.data?a.createElement("a",{download:"audio.webm",href:e.data},"Download Audio"):"Audio not yet available"))}},{bind:A}=u.Utils.misc;const M={name:"CursorRecorder",recorder:class{constructor(){A(this,["captureMouse"])}beginRecording(e){this.captureData=[],this.captureStart=e,this.pauseTime=0,this.paused=!1,C(document.body,"mousemove",this.captureMouse)}pauseRecording(e){this.paused=!0,this.lastPauseTime=e}resumeRecording(e){this.pauseTime+=e-this.lastPauseTime,this.paused=!1}async endRecording(){x(document.body,"mousemove",this.captureMouse);for(let e=this.captureData.length-1;e>=1;--e)this.captureData[e][0]-=this.captureData[e-1][0];for(let e=0;e<this.captureData.length;++e)this.captureData[e][0]=O(this.captureData[e][0]);return this.captureData}captureMouse(e){if(this.paused)return;const{left:t,top:n}=s(".rp-canvas").getBoundingClientRect(),r=Math.min(innerWidth,innerHeight);this.captureData.push([this.getTime(),[(e.pageX-t)/r*100,(e.pageY-n)/r*100].map(O)])}getTime(){return performance.now()-this.captureStart-this.pauseTime}},configureComponent:class extends F{render(){return this.state.active&&["recorder-plugin-icon"].push("active"),a.createElement("div",{className:"recorder-plugin",title:"Record cursor"},a.createElement("div",{className:"recorder-plugin-icon",style:{backgroundColor:this.state.active?"red":"#222",height:"36px",lineHeight:"36px",width:"36px"}},a.createElement("img",{height:"28",width:"28",src:"/img/cursor-large.png",onClick:this.toggleActive,style:{verticalAlign:"middle"}})),a.createElement("span",{className:"recorder-plugin-name"},"Cursor"))}},saveComponent:function(e){return console.log(e),a.createElement(a.Fragment,null,a.createElement("th",{key:"head",scope:"row"},a.createElement("img",{className:"recorder-plugin-icon",height:"28",width:"28",src:"/img/cursor-large.png"})),a.createElement("td",{key:"cell"},e.data?a.createElement("textarea",{readOnly:!0,value:JSON.stringify(e.data)}):"Cursor data not yet available."))}};function O(e){return parseFloat(e.toFixed(2))}const{bind:L}=u.Utils.misc,{formatTimeMs:B}=u.Utils.time,K=a.createElement("text",{fill:"#FFF",fontFamily:"Helvetica",fontSize:"75",textAnchor:"middle",x:"50",y:"75"},"Q");const $={name:"CueRecorder",recorder:class{constructor(e){this.player=e,L(this,["onKeyDown"])}beginRecording(e){this.cueCapture=[],this.lastTime=0,this.captureStart=e,this.paused=!1,this.pauseTime=0,C(document.body,"keydown",this.onKeyDown)}pauseRecording(e){this.paused=!0,this.lastPauseTime=e}resumeRecording(e){this.pauseTime+=e-this.lastPauseTime,this.paused=!1}async endRecording(){return x(document.body,"keydown",this.onKeyDown),this.captureCues(this.player.script.slideName),this.cueCapture}onKeyDown(e){if(this.paused)return;const{script:t}=this.player;this.player.$controls.captureKeys&&"e"===e.key.toLowerCase()&&this.captureCues(t.slides[t.slideIndex-1][0])}captureCues(e){const t=performance.now()-this.captureStart-this.pauseTime;this.cueCapture.push([e,B(t-this.lastTime)]),this.lastTime=t}},configureComponent:class extends F{render(){const e=["recorder-plugin-icon"];return this.state.active&&e.push("active"),a.createElement("div",{className:"recorder-plugin",title:"Record cues"},a.createElement("svg",{className:e.join(" "),height:"36",width:"36",viewBox:"0 0 100 100",onClick:this.toggleActive},a.createElement("rect",{height:"100",width:"100",fill:this.state.active?"red":"#222"}),K),a.createElement("span",{className:"recorder-plugin-name"},"Cues"))}},saveComponent:function(e){return a.createElement(a.Fragment,null,a.createElement("th",{key:"head",scope:"row"},a.createElement("svg",{className:"recorder-plugin-icon",height:"36",width:"36",viewBox:"0 0 100 100"},a.createElement("rect",{height:"100",width:"100",fill:"#222"}),K)),a.createElement("td",{key:"cell"},a.createElement("textarea",{readOnly:!0,value:JSON.stringify(e.data)})))}},{bind:j,whitelist:I}=u.Utils.misc,U=a.createElement("g",null,a.createElement("g",{transform:"translate(-138.61 -857.23)"},a.createElement("rect",{style:{strokeLinejoin:"round",stroke:"#FFF",strokeLinecap:"round",strokeWidth:3.8521,fill:"#FFF"},rx:"9.4681",ry:"14.97",height:"58.455",width:"121.82",y:"931.93",x:"171.45"}),a.createElement("path",{style:{stroke:"#000",strokeDasharray:"4.9175124 4.9175124",strokeWidth:4.9175,fill:"none"},d:"m184.06 947.36h94.08"}),a.createElement("path",{style:{stroke:"#000",strokeDasharray:"4.9175124 4.9175124",strokeWidth:4.9175,fill:"none"},d:"m184.06 957.05h94.08"}),a.createElement("path",{style:{stroke:"#000",strokeDasharray:"4.9175124 4.9175124",strokeWidth:4.9175,fill:"none"},d:"m184.06 966.75h94.08"}),a.createElement("path",{style:{stroke:"#FFF",strokeWidth:4.9175,fill:"none"},d:"m184.06 977.23h94.08"}),a.createElement("path",{style:{stroke:"#FFF",strokeLinecap:"round",strokeWidth:4.3986,fill:"none"},d:"m278.67 929.84s8.86-13.98-0.31-21.47c-10.76-8.79-20.81 8.66-36.55-3.07"})));const V={name:"KeyRecorder",recorder:class{constructor(e){j(this,["captureCursor","captureKey","captureKeySequence"]),this.cm=e[Symbol.for("KeyRecorder target")],console.log(this.cm)}beginRecording(e){this.captureStart=e,this.captureData=[],this.paused=!1,this.pauseTime=0,this.cm.on("change",this.captureKey),this.cm.on("cursorActivity",this.captureCursor),this.cm.on("keyHandled",this.captureKeySequence)}pauseRecording(e){this.paused=!0,this.lastPauseTime=e}resumeRecording(e){this.pauseTime+=e-this.lastPauseTime,this.paused=!1}async endRecording(){this.cm.off("change",this.captureKey),this.cm.off("cursorActivity",this.captureCursor),this.cm.off("keyHandled",this.captureKeySequence);for(let e=this.captureData.length-1;e>=1;--e)this.captureData[e][0]-=this.captureData[e-1][0];for(let e=0;e<this.captureData.length;++e)this.captureData[e][0]=G(this.captureData[e][0]);return this.captureData}captureCursor(e){if(this.paused)return;const t=e.getDoc().listSelections()[0],n=I(t.anchor,["line","ch"]),r=I(t.head,["line","ch"]);n.line===r.line&&n.ch===r.ch?this.captureData.push([this.getTime(),["cursor",I(n,["line","ch"])]]):this.captureData.push([this.getTime(),["selection",{anchor:n,head:r}]])}captureKey(e,{from:t,to:n,text:r,removed:a,origin:s}){this.paused||this.captureData.push([this.getTime(),["text",{from:I(t,["line","ch"]),to:I(n,["line","ch"]),text:r,removed:a}]])}captureKeySequence(e,t){this.paused||this.captureData.push([this.getTime(),["command",t]])}getTime(){return performance.now()-this.captureStart-this.pauseTime}},configureComponent:class extends F{render(){return this.state.active&&["recorder-plugin-icon"].push("active"),a.createElement("div",{className:"recorder-plugin",title:"Record keys"},a.createElement("svg",{className:"recorder-plugin-icon",height:"36",width:"36",viewBox:"0 0 187.5 187.5",onClick:this.toggleActive},a.createElement("rect",{x:"0",y:"0",height:"187.5",width:"187.5",fill:this.state.active?"red":"#222"}),U),a.createElement("span",{className:"recorder-plugin-name"},"Keys"))}},saveComponent:function(e){return a.createElement(a.Fragment,null,a.createElement("th",{key:"head",scope:"row"},a.createElement("svg",{className:"recorder-plugin-icon",height:"36",width:"36",viewBox:"0 0 187.5 187.5"},a.createElement("rect",{x:"0",y:"0",height:"187.5",width:"187.5",fill:"#222"}),U)),a.createElement("td",{key:"cell"},a.createElement("textarea",{readOnly:!0,value:JSON.stringify(e.data)})))}};function G(e){return parseFloat(e.toFixed(2))}const H=a.createElement("text",{fill:"#FFF",fontFamily:"Helvetica",fontSize:"75",textAnchor:"middle",x:"50",y:"75"},"I"),W=Symbol.for("InputRecorder targets"),z=Symbol.for("InputRecorder listener");const X={name:"InputRecorder",recorder:class{constructor(e){this.inputs=e[W]}beginRecording(e){this.captureData=new Map,this.captureStart=e,this.pauseTime=0,this.paused=!1;for(const e of this.inputs){const t=[[0,e.value]];this.captureData.set(e,t);const n=()=>t.push([this.getTime(),e.value]);e[z]=n,C(e,"input",n)}}pauseRecording(e){this.paused=!0,this.lastPauseTime=e}resumeRecording(e){this.pauseTime+=e-this.lastPauseTime,this.paused=!1}async endRecording(){const e=[];for(const t of this.inputs)e.push(this.captureData.get(t)),x(t,"input",t[z]);return e}getTime(){return parseFloat((performance.now()-this.captureStart-this.pauseTime).toFixed(2))}},configureComponent:class extends F{render(){return this.state.active&&["recorder-plugin-icon"].push("active"),a.createElement("div",{className:"recorder-plugin",title:"Record input"},a.createElement("svg",{className:"recorder-plugin-icon",height:"36",width:"36",viewBox:"0 0 100 100",onClick:this.toggleActive},a.createElement("rect",{height:"100",width:"100",fill:this.state.active?"red":"#222"}),H),a.createElement("span",{className:"recorder-plugin-name"},"Input"))}},saveComponent:function(e){return a.createElement(a.Fragment,null,a.createElement("th",{key:"head",scope:"row"},a.createElement("svg",{className:"recorder-plugin-icon",height:"36",width:"36",viewBox:"0 0 100 100"},H)),a.createElement("td",{key:"cell"},e.data?a.createElement("textarea",{readOnly:!0,value:JSON.stringify(e.data)}):"Input data not yet available."))}},q=a.createElement("path",{d:"M 12,26 18.5,22 18.5,14 12,10 z M 18.5,22 25,18 25,18 18.5,14 z",fill:"white"});const _={name:"PlayRecorder",recorder:class{constructor(e){this.player=e}beginRecording(e){this.player.playback.play()}async endRecording(){this.player.playback.pause()}pauseRecording(){}resumeRecording(){}},configureComponent:class extends F{render(){const e=["recorder-plugin-icon"];return this.state.active&&e.push("active"),a.createElement("div",{className:"recorder-plugin",title:"Play video when recording starts"},a.createElement("svg",{className:e.join(" "),height:"36",width:"36",viewBox:"0 0 36 36",onClick:this.toggleActive},a.createElement("rect",{height:"100",width:"100",fill:this.state.active?"red":"#222"}),q),a.createElement("span",{className:"recorder-plugin-name"},"Play"))}},saveComponent:function(){return null}},J=a.createElement("text",{fill:"#FFF",fontFamily:"Helvetica",fontSize:"75",textAnchor:"middle",x:"50",y:"75"},"R"),Y=Symbol.for("StateRecorder targets"),Q=Symbol.for("StateRecorder listener");const Z={name:"StateRecorder",recorder:class{constructor(e){this.components=e[Y]}beginRecording(e){this.captureData=new Map,this.captureStart=e,this.pauseTime=0,this.paused=!1;for(const e of this.components){const t=[[0,e.state]];this.captureData.set(e,t);const n=e=>t.push([this.getTime(),e]);e[Q]=n}}async endRecording(){const e=[];for(const t of this.components)e.push(this.captureData.get(t)),delete t[Q];return e}pauseRecording(e){this.paused=!0,this.lastPauseTime=e}resumeRecording(e){this.pauseTime+=e-this.lastPauseTime,this.paused=!1}getTime(){return parseFloat((performance.now()-this.captureStart-this.pauseTime).toFixed(2))}},configureComponent:class extends F{render(){return this.state.active&&["recorder-plugin-icon"].push("active"),a.createElement("div",{className:"recorder-plugin",title:"Record state of React component"},a.createElement("svg",{className:"recorder-plugin-icon",height:"36",width:"36",viewBox:"0 0 100 100",onClick:this.toggleActive},a.createElement("rect",{height:"100",width:"100",fill:this.state.active?"red":"#222"}),J),a.createElement("span",{className:"recorder-plugin-name"},"State"))}},saveComponent:function(e){return a.createElement(a.Fragment,null,a.createElement("th",{key:"head",scope:"row"},a.createElement("svg",{className:"recorder-plugin-icon",height:"36",width:"36",viewBox:"0 0 100 100"},J)),a.createElement("td",{key:"cell"},e.data?a.createElement("textarea",{readOnly:!0,value:JSON.stringify(e.data)}):"State data not yet available."))}},{bind:ee,constrain:te}=u.Utils.misc,{formatTimeMs:ne}=u.Utils.time;class re extends u.Player.PureReceiver{componentDidMount(){const{playback:e}=this.props.player;e.hub.on("seek",()=>this.forceUpdate()),e.hub.on("timeupdate",()=>this.forceUpdate())}render(){const{playback:e,script:t}=this.props.player,n=t.slides[t.slideIndex][1],r=i("audio").filter(e=>!e.paused)[0];r&&r.currentTime;return a.createElement("div",{className:"editor-controls"},a.createElement(u.Player.Broadcaster,null,!1,a.createElement("span",{className:"rp-duration"},ne(e.currentTime-n)),a.createElement("span",{className:"rp-controls-slidename"},t.slideName),a.createElement(b,null),a.createElement(v,null),a.createElement(T,{ref:e=>this.$recorderComponent=e,plugins:[$,D,M,V,X,_,Z]})))}}const{screenToSVGVector:ae}=u.Utils.graphics,{dragHelper:se}=u.Utils.interactivity,{$:ie,$$:oe}=r,ce=window,le={makeDraggable(e){let t,n,r;function a(a){let s,i;a.stopPropagation(),a.preventDefault(),t=a.pageX,n=a.pageY,(r=o("span")).className="coordinates-box",e instanceof HTMLElement||e instanceof SVGSVGElement?(s=Math.round(parseFloat(e.style.left.slice(0,-4))/u.aspectRatio),i=Math.round(parseFloat(e.style.top.slice(0,-4))/u.aspectRatio)):(s=e.getAttribute(de(e)),i=e.getAttribute(ue(e))),r.textContent=`(${s},${i})`,document.body.appendChild(r)}function s(e){l(r),t=n=null}(e instanceof HTMLElement||e instanceof SVGSVGElement)&&(e.style.position="absolute"),e instanceof HTMLElement||e instanceof SVGSVGElement?e.addEventListener("mousedown",se(function(a){const s=function(e){if(void 0!==e.offsetLeft&&void 0!==e.offsetTop)return{left:e.offsetLeft,top:e.offsetTop};const t=e.getBoundingClientRect();let n=e;for(;n=n.parentNode;){if(!["absolute","relative"].includes(getComputedStyle(n).position))continue;const e=n.getBoundingClientRect();return{left:t.left-e.left,top:t.top-e.top}}return{left:t.left,top:t.top}}(e),i=s.left+a.pageX-t,o=s.top+a.pageY-n,c=Math.min(innerWidth,innerHeight)/100,l=i/c,d=o/c;t=a.pageX,n=a.pageY,Object.assign(e.style,{left:`${l}vmin`,top:`${d}vmin`}),r.textContent=`(${Math.round(l/u.aspectRatio)}, ${Math.round(d/u.aspectRatio)})`},a,s)):e.addEventListener("mousedown",se(function(a){0;const[s,i]=ae(function(e){let t=e;for(;t=t.parentNode;)if("svg"===t.nodeName.toLowerCase())return t}(e),a.pageX-t,a.pageY-n);if(t=a.pageX,n=a.pageY,e instanceof SVGGElement){const t=e.transform.baseVal;window.t=t,0===t.numberOfItems&&t.appendItem(e.ownerSVGElement.createSVGTransform()),t.consolidate();const n=t.getItem(0).matrix;n.e+=s,n.f+=i,r.textContent=`(${Math.round(n.e)}, ${Math.round(n.f)})`}else{const t=parseFloat(e.getAttribute(de(e))),n=parseFloat(e.getAttribute(ue(e)));e.setAttribute(de(e),(t+s).toString()),e.setAttribute(ue(e),(n+i).toString()),r.textContent=`(${Math.round(t+s)}, ${Math.round(n+i)})`}},a,s))}};function de(e){switch(e.nodeName){case"circle":return"cx";default:return"x"}}function ue(e){switch(e.nodeName){case"circle":return"cy";default:return"y"}}var he=function(){ce._edit={"data-ractive-editor-draggable":"yes"},document.addEventListener("DOMContentLoaded",()=>{oe("*[data-ractive-editor-draggable]").forEach(le.makeDraggable)})};t.default=new class{constructor(){this.recorders={}}setup(e){e("classNames",()=>"editor"),e("canvasClick",()=>!1),e("controls",()=>a.createElement(re,{key:"rpe"})),he()}}}]);